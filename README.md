# smithy-gh-pages-action
GitHub Action to generate and deploy API documentation to GitHub Pages, using Smithy models or OpenAPI specification files as input.

By default, API docs are generated at *username*.github.io/*repository-name*/*provided-api-doc-filepath*.

If you've set up a [GitHub Pages custom domain](https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site) for your account, that will be used instead of *username*.github.io.

See [example API docs generated by this GitHub Action](https://www.marksayson.com/smithy-gh-pages-action/v1/test-api-docs.html).

### Prerequisites

1. GitHub Pages requires that source repositories either be public or in [supported paid accounts](https://docs.github.com/en/pages/getting-started-with-github-pages/about-github-pages).
2. The repository must have GitHub Pages enabled with GitHub Actions, by going to "Settings" > "Pages" > "Build and deployment", and under "Source", selecting "GitHub Actions".
3. The repository must either:
   1. Provide a pre-built OpenAPI JSON spec file; or
   2. Be built using Gradle and provide a Gradle task that generates an OpenAPI JSON spec file.

### Usage
See [action.yml](action.yml)

Add the following permissions to your GitHub workflow, prior to the lines defining workflow jobs.

```yaml
# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write
```

Add the following steps to your GitHub workflow, replacing the input values:

```yaml
- name: Generate API docs and deploy to GitHub Pages
  uses: msayson/smithy-gh-pages-action@v1.1.0
  with:
    # Name of Gradle task to generate OpenAPI JSON spec from Smithy models
    # If not provided, the OpenAPI JSON spec must be provided by your package
    gradle-smithy-task-name: 'REPLACE_WITH_GRADLE_TASK_NAME'
    # Filepath of input OpenAPI JSON spec
    openapi-json-filepath: 'REPLACE_WITH_OPENAPI_JSON_FILEPATH'
    # Filepath to use for generated API docs HTML
    api-docs-filepath: 'REPLACE_WITH_API_DOCS_FILEPATH'
```

#### Workflow example
```yaml
name: Generate API docs and deploy to GitHub Pages

on:
  # Automatically trigger when push to main branch
  push:
    branches: ["main"]
  # Enable running workflow manually from GitHub Actions
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  generate-api-docs:
    name: Generate API Documentation
    runs-on: ubuntu-latest
    steps:
      - name: Generate API docs and deploy to GitHub Pages
        uses: msayson/smithy-gh-pages-action@v1.1.0
        with:
          gradle-smithy-task-name: build
          openapi-json-filepath: build/smithyprojections/consent-management-api-models/source/openapi/ConsentManagementApi.openapi.json
          api-docs-filepath: v1/docs.html
```

### Known limitations
The current GitHub Action only supports deploying a single version of API documentation to GitHub Pages at a given time.

For example, if you run the action with `api-docs-filepath: v1/docs.html`, and later run the action with `api-docs-filepath: v2/docs.html`, only the most recent run's API documentation will be deployed to your GitHub Page, even if they have distinct filepaths.

### Technologies
[yq](https://github.com/mikefarah/yq) is used to convert JSON to YAML, since YAML is the required format for ReDoc, while many tools such as Smithy generate OpenAPI specs with the JSON format.

[ReDoc](https://github.com/Redocly/redoc) is used to automatically generate API documentation from the OpenAPI YAML specification.

[GitHub Actions](https://docs.github.com/en/actions) are used to automatically generate and deploy HTML API documentation to [GitHub Pages](https://pages.github.com/).
